---
app-id: com.ankama.Dofus
runtime: org.winepak.Platform/i386/3.0
sdk: org.winepak.Sdk/i386/3.0

#I guess it needs netapi which is disabled in winepak
add-extensions:
  org.winepak.Platform.Wine.Compat32:
    directory: wine
    version: 3.8-staging
    add-ld-path: lib
    no-autodownload: false

tags:
- proprietary

finish-args:
- "--share=ipc"
- "--share=network"
- "--socket=x11"
- "--device=dri"
- "--socket=pulseaudio"
- "--env=PATH=/app/wine/bin:/app/bin:/usr/bin"
- "--env=GTK_PATH=/app/lib/gtk-2.0"
- "--env=G_FILENAME_ENCODING=UTF-8"
- "--device=all"
- "--allow=multiarch"
- "--persist=.appdata"

command: "/app/bin/startup.sh"

modules:
- name: setup-wine
  buildsystem: simple
  build-commands:
  - mkdir -p /app/wine

- name: dofus-libraries
  config-opts:
  - --prefix=/app
  - --libdir=/app/lib
  sources:
  - type: archive
    url: https://sourceforge.net/projects/libpng/files/libpng12/1.2.59/libpng-1.2.59.tar.xz
    sha256: b4635f15b8adccc8ad0934eea485ef59cc4cae24d0f0300a9a941e51974ffcc7

- name: dofus
  no-autogen: true
  buildsystem: simple
  build-commands:
  - cp -r Dofus /app/Dofus
  - chmod 766 -R /app/Dofus
  sources:
  - type: archive
    url: http://dl.ak.ankama.com/games/installers/dofus-x86.tar.gz
    sha256: a57149c0d0ad8c44a3be0d2ada381d8032e923e55d0225243aece626e4d45296

- name: startup
  no-autogen: true
  buildsystem: simple
  build-commands:
  - install -Dm766 startup.sh /app/bin/startup.sh
  - install -Dm766 com.ankama.Dofus.desktop /app/share/applications/com.ankama.Dofus.desktop
  - install -Dm766 /app/Dofus/share/updater_data/icons/game_icon_512x512.png /app/share/icons/hicolor/512x512/apps/com.ankama.Dofus.png
  sources:
  - type: file
    path: startup.sh
  - type: file
    path: com.ankama.Dofus.desktop
